<html>
<head>
	<title></title>
	<script src="../maskitor.js"></script>
</head>
<body>

	<!-- Container -->
	<div id="container"></div>

	<br>

	Select a local file to change background:<br>
	<input type="file" id="select" value="Select backdrop"><br><br>
	Download mask in pgm-format<br>
	<button id="download">Get mask.pgm</button>

	<!-- Example usage! -->
	<script>
	
		// Initialize editor, parameters:
		//   1. Id of container element in where to place the editor
		//   2. editor width
		//   3. editor height
		//   4. camera resoltion x
		//   5. camera resoltion y
		var editor = new Maskitor("container", 800, 600, 1280, 960);

		// Load backdrop into image object, i guess it's possible to get 
		// an image object from a canvas element insted of file.
		var backdrop = new Image();
		backdrop.src = "backdrop.jpg";
		backdrop.onload = function() {

			// setBackdrop expects a Image object
			editor.setBackdrop(backdrop);

		};

		// Load mask file as binary data
	    var rawFile = new XMLHttpRequest();
	    rawFile.open("GET", "mask.pgm", true);
	    rawFile.responseType = "arraybuffer";
	    rawFile.overrideMimeType("application/octet-stream;");
	    rawFile.onload = function (e) {

	    	// setMask expects a binary representation of the mask file
            editor.setMask(new Uint8Array(rawFile.response));

	    }
	    rawFile.send(null);

	    // Get pgm-file from editor
	    var btnDownload = document.getElementById('download');
	    btnDownload.addEventListener('click', function () {

	    	// Create PGMFile object
			var pgmFile = new Maskitor.PGMFile(),

			// Populate pgmFile with data from maskContext, save the binary file representation (Arraybuffer) in variable binaryData
				binaryData = pgmFile.fromContext(editor.maskContext).toBinaryData(),

			// Convert arraybuffer to a typed blob, this is only done to allow us to download the file in the example,
			// in a real world situation, binaryData could probably be sent directly to the server with ajax.
				blobData = new Blob([binaryData], {type : 'application/octet-stream'}); // the blob

			// This is a hack to download the data as a file, definitiely not necessary in a real world situation
			if (navigator.appVersion.toString().indexOf('.NET') > 0) {
				window.navigator.msSaveBlob(blobData, "mask.pgm");
			} else {
				var link = document.createElement('a');
				link.rel = 'application/octet-stream';
				link.href = window.URL.createObjectURL(blobData);
				link.download = "mask.pgm";
				link.innerHTML = "Image";
				document.body.appendChild(link);
				link.click();
				document.body.removeChild(link);
			}

	    });

	    // Change backdrop
	    var btnSelect = document.getElementById('select');
	    btnSelect.addEventListener('change', function (e) {

			var file = e.target.files[0];
			if (!file) {
				return;
			}

			var reader = new FileReader();
			reader.onload = function(e) {
				var contents = e.target.result;
				
				var blob = new Blob( [ contents ], { type: "image/png" } );
			    var urlCreator = window.URL || window.webkitURL;
			    var imageUrl = urlCreator.createObjectURL( blob );
			    var img = new Image();
			    img.src = imageUrl;
			    img.onload = function () {
			    	editor.setBackdrop(img, true);
			    };

			};
			reader.readAsArrayBuffer(file);


	    });

		
	</script>

</body>
</html>